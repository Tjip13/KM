<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KM Registratie Tool</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Eenvoudige icoon componenten
        const Plus = () => <span>‚ûï</span>;
        const Calendar = () => <span>üìÖ</span>;
        const MapPin = () => <span>üìç</span>;
        const Car = () => <span>üöó</span>;
        const BarChart3 = () => <span>üìä</span>;
        const Trash2 = () => <span>üóëÔ∏è</span>;
        const Edit = () => <span>‚úèÔ∏è</span>;
        const Download = () => <span>üíæ</span>;
        const Upload = () => <span>üì§</span>;
        const Settings = () => <span>‚öôÔ∏è</span>;

        const KmRegistratieTool = () => {
            const [ritten, setRitten] = useState([]);
            const [nieuweRit, setNieuweRit] = useState({
                datum: new Date().toISOString().split('T')[0],
                vertrekLocatie: '',
                viaLocatie: '',
                eindLocatie: '',
                beginKmStand: '',
                eindKmStand: '',
                type: 'zakelijk'
            });
            const [filterMaand, setFilterMaand] = useState(new Date().toISOString().slice(0, 7));
            const [filterJaar, setFilterJaar] = useState(new Date().getFullYear().toString());
            const [viewMode, setViewMode] = useState('invoer');
            const [editingId, setEditingId] = useState(null);
            const [locatieSuggesties, setLocatieSuggesties] = useState([]);
            const [activeField, setActiveField] = useState(null);
            const [afkortingen, setAfkortingen] = useState({});
            const [nieuweAfkorting, setNieuweAfkorting] = useState({ 
                afkorting: '', 
                volledigeNaam: '', 
                adres: '' 
            });

            // Laad data uit localStorage bij opstarten
            useEffect(() => {
                const opgeslagenRitten = localStorage.getItem('kmRegistratie');
                if (opgeslagenRitten) {
                    setRitten(JSON.parse(opgeslagenRitten));
                }
                
                const opgeslagenAfkortingen = localStorage.getItem('kmAfkortingen');
                if (opgeslagenAfkortingen) {
                    setAfkortingen(JSON.parse(opgeslagenAfkortingen));
                }
            }, []);

            // Sla data op in localStorage bij wijzigingen
            useEffect(() => {
                localStorage.setItem('kmRegistratie', JSON.stringify(ritten));
            }, [ritten]);

            // Sla afkortingen op
            useEffect(() => {
                localStorage.setItem('kmAfkortingen', JSON.stringify(afkortingen));
            }, [afkortingen]);

            // Voeg handmatig afkorting toe
            const voegAfkortingToe = () => {
                if (!nieuweAfkorting.afkorting || !nieuweAfkorting.volledigeNaam) {
                    alert('Vul zowel afkorting als volledige naam in');
                    return;
                }
                
                if (nieuweAfkorting.afkorting.length > 5) {
                    alert('Afkorting mag maximaal 5 karakters zijn');
                    return;
                }
                
                const afkorting = nieuweAfkorting.afkorting.toUpperCase();
                const afkortingLower = nieuweAfkorting.afkorting.toLowerCase();
                
                // Maak de volledige tekst (naam + adres indien aanwezig)
                const volledigeTekst = nieuweAfkorting.adres ? 
                    `${nieuweAfkorting.volledigeNaam} (${nieuweAfkorting.adres})` : 
                    nieuweAfkorting.volledigeNaam;
                
                setAfkortingen(prev => ({
                    ...prev,
                    [afkorting]: {
                        naam: nieuweAfkorting.volledigeNaam,
                        adres: nieuweAfkorting.adres || '',
                        volledigeTekst: volledigeTekst
                    },
                    [afkortingLower]: {
                        naam: nieuweAfkorting.volledigeNaam,
                        adres: nieuweAfkorting.adres || '',
                        volledigeTekst: volledigeTekst
                    }
                }));
                
                setNieuweAfkorting({ afkorting: '', volledigeNaam: '', adres: '' });
                alert(`Afkorting "${afkorting}" toegevoegd!`);
            };

            // Verwijder afkorting
            const verwijderAfkorting = (afkorting) => {
                if (confirm(`Afkorting "${afkorting}" verwijderen?`)) {
                    const nieuweAfkortingen = { ...afkortingen };
                    delete nieuweAfkortingen[afkorting];
                    delete nieuweAfkortingen[afkorting.toLowerCase()];
                    setAfkortingen(nieuweAfkortingen);
                }
            };

            // Expandeer afkortingen bij typen
            const expandeerAfkorting = (input) => {
                if (afkortingen[input]) {
                    return afkortingen[input].volledigeTekst || afkortingen[input];
                }
                return input;
            };

            // Verzamel unieke locaties uit alle ritten + afkortingen
            const getUniekeLocaties = () => {
                const locaties = new Set();
                ritten.forEach(rit => {
                    if (rit.vertrekLocatie) locaties.add(rit.vertrekLocatie);
                    if (rit.eindLocatie) locaties.add(rit.eindLocatie);
                    if (rit.viaLocatie) locaties.add(rit.viaLocatie);
                });
                
                // Voeg afkortingen toe aan suggesties
                Object.keys(afkortingen).forEach(afkorting => {
                    const afkortingData = afkortingen[afkorting];
                    if (typeof afkortingData === 'object') {
                        locaties.add(`${afkorting} ‚Üí ${afkortingData.volledigeTekst}`);
                    } else {
                        // Backward compatibility voor oude afkortingen
                        locaties.add(`${afkorting} ‚Üí ${afkortingData}`);
                    }
                });
                
                return Array.from(locaties).sort();
            };

            // Filter locaties gebaseerd op input
            const filterLocaties = (input, field) => {
                if (!input || input.length < 1) {
                    setLocatieSuggesties([]);
                    return;
                }
                
                const uniekeLocaties = getUniekeLocaties();
                const gefilterd = uniekeLocaties.filter(locatie => 
                    locatie.toLowerCase().includes(input.toLowerCase())
                ).slice(0, 5); // Max 5 suggesties
                
                setLocatieSuggesties(gefilterd);
                setActiveField(field);
            };

            // Selecteer een suggestie
            const selecteerSuggestie = (locatie) => {
                // Als het een afkorting suggestie is (bevat ‚Üí), pak de volledige naam
                const definitieveLocatie = locatie.includes(' ‚Üí ') ? 
                    locatie.split(' ‚Üí ')[1] : locatie;
                    
                setNieuweRit({...nieuweRit, [activeField]: definitieveLocatie});
                setLocatieSuggesties([]);
                setActiveField(null);
            };

            // Handle locatie input wijzigingen
            const handleLocatieWijziging = (value, field) => {
                // Probeer afkorting te expanderen
                const geexpandeerdWaarde = expandeerAfkorting(value);
                
                setNieuweRit({...nieuweRit, [field]: geexpandeerdWaarde});
                filterLocaties(geexpandeerdWaarde, field);
            };

            const berekenGeredenKm = () => {
                const begin = parseFloat(nieuweRit.beginKmStand) || 0;
                const eind = parseFloat(nieuweRit.eindKmStand) || 0;
                return Math.max(0, eind - begin);
            };

            const voegRitToe = () => {
                if (!nieuweRit.datum || !nieuweRit.vertrekLocatie || !nieuweRit.eindLocatie || 
                    !nieuweRit.beginKmStand || !nieuweRit.eindKmStand) {
                    alert('Vul alle verplichte velden in');
                    return;
                }

                const geredenKm = berekenGeredenKm();
                if (geredenKm <= 0) {
                    alert('Eind km-stand moet hoger zijn dan begin km-stand');
                    return;
                }

                const rit = {
                    id: editingId || Date.now(),
                    ...nieuweRit,
                    beginKmStand: parseFloat(nieuweRit.beginKmStand),
                    eindKmStand: parseFloat(nieuweRit.eindKmStand),
                    geredenKm: geredenKm
                };

                if (editingId) {
                    setRitten(ritten.map(r => r.id === editingId ? rit : r));
                    setEditingId(null);
                } else {
                    setRitten([...ritten, rit]);
                }

                // Geen automatische afkortingen meer - alleen handmatige

                // Slimme reset voor volgende rit
                const eindKmStr = nieuweRit.eindKmStand.toString();
                const eerstedriecijfers = eindKmStr.length >= 3 ? eindKmStr.substring(0, 3) : eindKmStr;
                
                setNieuweRit({
                    datum: nieuweRit.datum, // Behoud laatste datum
                    vertrekLocatie: nieuweRit.eindLocatie, // Laatste eindlocatie wordt vertreklocatie
                    viaLocatie: '',
                    eindLocatie: '',
                    beginKmStand: nieuweRit.eindKmStand, // Laatste eind-km wordt begin-km
                    eindKmStand: eerstedriecijfers, // Eerste 3 cijfers vooringevuld
                    type: nieuweRit.type // Behoud laatste type
                });
            };

            const bewerkRit = (rit) => {
                setNieuweRit({
                    datum: rit.datum,
                    vertrekLocatie: rit.vertrekLocatie,
                    viaLocatie: rit.viaLocatie || '',
                    eindLocatie: rit.eindLocatie,
                    beginKmStand: rit.beginKmStand.toString(),
                    eindKmStand: rit.eindKmStand.toString(),
                    type: rit.type
                });
                setEditingId(rit.id);
                setViewMode('invoer');
            };

            const verwijderRit = (id) => {
                if (confirm('Weet je zeker dat je deze rit wilt verwijderen?')) {
                    setRitten(ritten.filter(r => r.id !== id));
                }
            };

            const annuleerBewerken = () => {
                setEditingId(null);
                
                // Bij annuleren: ook slimme reset toepassen als er ritten zijn
                if (ritten.length > 0) {
                    const laatsteRit = ritten[ritten.length - 1];
                    const eindKmStr = laatsteRit.eindKmStand.toString();
                    const eerstedriecijfers = eindKmStr.length >= 3 ? eindKmStr.substring(0, 3) : eindKmStr;
                    
                    setNieuweRit({
                        datum: laatsteRit.datum,
                        vertrekLocatie: laatsteRit.eindLocatie,
                        viaLocatie: '',
                        eindLocatie: '',
                        beginKmStand: laatsteRit.eindKmStand.toString(),
                        eindKmStand: eerstedriecijfers,
                        type: laatsteRit.type
                    });
                } else {
                    setNieuweRit({
                        datum: new Date().toISOString().split('T')[0],
                        vertrekLocatie: '',
                        viaLocatie: '',
                        eindLocatie: '',
                        beginKmStand: '',
                        eindKmStand: '',
                        type: 'zakelijk'
                    });
                }
            };

            const filterRittenPerMaand = () => {
                return ritten.filter(rit => rit.datum.startsWith(filterMaand));
            };

            const filterRittenPerJaar = () => {
                return ritten.filter(rit => rit.datum.startsWith(filterJaar));
            };

            const berekenTotalen = (gefilterderitten) => {
                return gefilterderitten.reduce((totaal, rit) => {
                    totaal[rit.type] = (totaal[rit.type] || 0) + rit.geredenKm;
                    totaal.totaal = (totaal.totaal || 0) + rit.geredenKm;
                    return totaal;
                }, {});
            };

            const maandTotalen = berekenTotalen(filterRittenPerMaand());
            const jaarTotalen = berekenTotalen(filterRittenPerJaar());

            // Export naar CSV functie
            const exporteerNaarCSV = () => {
                if (ritten.length === 0) {
                    alert('Geen ritten om te exporteren');
                    return;
                }

                // CSV header
                const csvHeader = 'Datum,Vertrek Locatie,Via Locatie,Eind Locatie,Begin KM,Eind KM,Gereden KM,Type\n';
                
                // CSV data
                const csvData = ritten.map(rit => {
                    const datum = new Date(rit.datum).toLocaleDateString('nl-NL');
                    const via = rit.viaLocatie || '';
                    return `"${datum}","${rit.vertrekLocatie}","${via}","${rit.eindLocatie}",${rit.beginKmStand},${rit.eindKmStand},${rit.geredenKm},"${rit.type}"`;
                }).join('\n');

                const csvContent = csvHeader + csvData;
                
                // Download bestand
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `km-registratie-${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            // Import van CSV functie
            const importeerVanCSV = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const csv = e.target.result;
                        const lines = csv.split('\n');
                        const importedRitten = [];

                        // Skip header row
                        for (let i = 1; i < lines.length; i++) {
                            const line = lines[i].trim();
                            if (!line) continue;

                            // Parse CSV line (simpele versie)
                            const matches = line.match(/(".*?"|[^,]*)/g);
                            if (matches && matches.length >= 8) {
                                const cleanValue = (val) => val.replace(/^"|"$/g, '').trim();
                                
                                const rit = {
                                    id: Date.now() + i,
                                    datum: new Date(cleanValue(matches[0]).split('/').reverse().join('-')).toISOString().split('T')[0],
                                    vertrekLocatie: cleanValue(matches[1]),
                                    viaLocatie: cleanValue(matches[2]),
                                    eindLocatie: cleanValue(matches[3]),
                                    beginKmStand: parseFloat(cleanValue(matches[4])),
                                    eindKmStand: parseFloat(cleanValue(matches[5])),
                                    geredenKm: parseFloat(cleanValue(matches[6])),
                                    type: cleanValue(matches[7])
                                };
                                
                                if (rit.datum && rit.vertrekLocatie && rit.eindLocatie) {
                                    importedRitten.push(rit);
                                }
                            }
                        }

                        if (importedRitten.length > 0) {
                            if (confirm(`${importedRitten.length} ritten gevonden. Toevoegen aan huidige data?`)) {
                                setRitten([...ritten, ...importedRitten]);
                                alert(`${importedRitten.length} ritten succesvol ge√Ømporteerd!`);
                            }
                        } else {
                            alert('Geen geldige ritten gevonden in het bestand');
                        }
                    } catch (error) {
                        alert('Fout bij het importeren van het bestand');
                    }
                };
                reader.readAsText(file);
                
                // Reset file input
                event.target.value = '';
            };

            return (
                <div className="max-w-6xl mx-auto p-6 bg-gray-50 min-h-screen">
                    <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h1 className="text-3xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                            <Car />
                            KM Registratie Tool
                        </h1>

                        {/* Navigation */}
                        <div className="flex gap-4 mb-6">
                            <button
                                onClick={() => setViewMode('invoer')}
                                className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                                    viewMode === 'invoer' 
                                        ? 'bg-blue-600 text-white' 
                                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                }`}
                            >
                                <Plus /> Rit Invoeren
                            </button>
                            <button
                                onClick={() => setViewMode('overzicht')}
                                className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                                    viewMode === 'overzicht' 
                                        ? 'bg-blue-600 text-white' 
                                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                }`}
                            >
                                <BarChart3 /> Overzicht
                            </button>
                            <button
                                onClick={() => setViewMode('afkortingen')}
                                className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                                    viewMode === 'afkortingen' 
                                        ? 'bg-blue-600 text-white' 
                                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                }`}
                            >
                                <Settings /> Afkortingen
                            </button>
                            
                            {/* Export/Import knoppen */}
                            <div className="flex gap-2 ml-auto">
                                <button
                                    onClick={exporteerNaarCSV}
                                    className="px-4 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors"
                                    title="Exporteer naar Excel/CSV"
                                >
                                    <Download /> Export
                                </button>
                                <label className="px-4 py-2 bg-orange-600 text-white rounded-lg font-medium hover:bg-orange-700 transition-colors cursor-pointer" title="Importeer CSV bestand">
                                    <Upload /> Import
                                    <input
                                        type="file"
                                        accept=".csv"
                                        onChange={importeerVanCSV}
                                        className="hidden"
                                    />
                                </label>
                            </div>
                        </div>

                        {/* Rit Invoer */}
                        {viewMode === 'invoer' && (
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            <Calendar /> Datum *
                                        </label>
                                        <input
                                            type="date"
                                            value={nieuweRit.datum}
                                            onChange={(e) => setNieuweRit({...nieuweRit, datum: e.target.value})}
                                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        />
                                    </div>

                                    <div className="relative">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            <MapPin /> Vertrek Locatie *
                                        </label>
                                        <input
                                            type="text"
                                            value={nieuweRit.vertrekLocatie}
                                            onChange={(e) => handleLocatieWijziging(e.target.value, 'vertrekLocatie')}
                                            onFocus={() => filterLocaties(nieuweRit.vertrekLocatie, 'vertrekLocatie')}
                                            onBlur={() => setTimeout(() => {
                                                setLocatieSuggesties([]);
                                                setActiveField(null);
                                            }, 200)}
                                            placeholder="Bijv. Thuis, Kantoor Amsterdam, FO (Frans Otten Stadion)"
                                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        />
                                        {locatieSuggesties.length > 0 && activeField === 'vertrekLocatie' && (
                                            <div className="absolute z-10 w-full bg-white border border-gray-300 rounded-lg shadow-lg mt-1 max-h-48 overflow-y-auto">
                                                {locatieSuggesties.map((suggestie, index) => (
                                                    <button
                                                        key={index}
                                                        type="button"
                                                        onClick={() => selecteerSuggestie(suggestie)}
                                                        className="w-full text-left p-3 hover:bg-blue-50 focus:bg-blue-50 focus:outline-none border-b border-gray-100 last:border-b-0"
                                                    >
                                                        <MapPin /> {suggestie}
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    <div className="relative">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            <MapPin /> Via Locatie (optioneel)
                                        </label>
                                        <input
                                            type="text"
                                            value={nieuweRit.viaLocatie}
                                            onChange={(e) => handleLocatieWijziging(e.target.value, 'viaLocatie')}
                                            onFocus={() => filterLocaties(nieuweRit.viaLocatie, 'viaLocatie')}
                                            onBlur={() => setTimeout(() => {
                                                setLocatieSuggesties([]);
                                                setActiveField(null);
                                            }, 200)}
                                            placeholder="Bijv. Tankstation, MC (Media Centrum), FO"
                                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        />
                                        {locatieSuggesties.length > 0 && activeField === 'viaLocatie' && (
                                            <div className="absolute z-10 w-full bg-white border border-gray-300 rounded-lg shadow-lg mt-1 max-h-48 overflow-y-auto">
                                                {locatieSuggesties.map((suggestie, index) => (
                                                    <button
                                                        key={index}
                                                        type="button"
                                                        onClick={() => selecteerSuggestie(suggestie)}
                                                        className="w-full text-left p-3 hover:bg-blue-50 focus:bg-blue-50 focus:outline-none border-b border-gray-100 last:border-b-0"
                                                    >
                                                        <MapPin /> {suggestie}
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    <div className="relative">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            <MapPin /> Eind Locatie *
                                        </label>
                                        <input
                                            type="text"
                                            value={nieuweRit.eindLocatie}
                                            onChange={(e) => handleLocatieWijziging(e.target.value, 'eindLocatie')}
                                            onFocus={() => filterLocaties(nieuweRit.eindLocatie, 'eindLocatie')}
                                            onBlur={() => setTimeout(() => {
                                                setLocatieSuggesties([]);
                                                setActiveField(null);
                                            }, 200)}
                                            placeholder="Bijv. KA (Kantoor Amsterdam), Thuis, FO"
                                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        />
                                        {locatieSuggesties.length > 0 && activeField === 'eindLocatie' && (
                                            <div className="absolute z-10 w-full bg-white border border-gray-300 rounded-lg shadow-lg mt-1 max-h-48 overflow-y-auto">
                                                {locatieSuggesties.map((suggestie, index) => (
                                                    <button
                                                        key={index}
                                                        type="button"
                                                        onClick={() => selecteerSuggestie(suggestie)}
                                                        className="w-full text-left p-3 hover:bg-blue-50 focus:bg-blue-50 focus:outline-none border-b border-gray-100 last:border-b-0"
                                                    >
                                                        <MapPin /> {suggestie}
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                </div>

                                <div className="space-y-4">
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Begin KM Stand *
                                            </label>
                                            <input
                                                type="number"
                                                value={nieuweRit.beginKmStand}
                                                onChange={(e) => setNieuweRit({...nieuweRit, beginKmStand: e.target.value})}
                                                placeholder="123456"
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Eind KM Stand *
                                            </label>
                                            <input
                                                type="number"
                                                value={nieuweRit.eindKmStand}
                                                onChange={(e) => setNieuweRit({...nieuweRit, eindKmStand: e.target.value})}
                                                placeholder="123500"
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Type Rit
                                        </label>
                                        <select
                                            value={nieuweRit.type}
                                            onChange={(e) => setNieuweRit({...nieuweRit, type: e.target.value})}
                                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        >
                                            <option value="zakelijk">Zakelijk</option>
                                            <option value="prive">Priv√©</option>
                                            <option value="gemengd">Gemengd</option>
                                        </select>
                                    </div>

                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <div className="text-sm text-gray-600 mb-2">Gereden KM:</div>
                                        <div className="text-2xl font-bold text-blue-600">
                                            {berekenGeredenKm()} km
                                        </div>
                                    </div>

                                    <div className="flex gap-3">
                                        <button
                                            onClick={voegRitToe}
                                            className="flex-1 bg-blue-600 text-white p-3 rounded-lg font-medium hover:bg-blue-700 transition-colors"
                                        >
                                            {editingId ? 'Rit Bijwerken' : 'Rit Toevoegen'}
                                        </button>
                                        {editingId && (
                                            <button
                                                onClick={annuleerBewerken}
                                                className="px-4 py-3 bg-gray-500 text-white rounded-lg font-medium hover:bg-gray-600 transition-colors"
                                            >
                                                Annuleren
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Overzicht */}
                        {viewMode === 'overzicht' && (
                            <div className="space-y-6">
                                {/* Filters */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 bg-gray-50 p-4 rounded-lg">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Maand Filter
                                        </label>
                                        <input
                                            type="month"
                                            value={filterMaand}
                                            onChange={(e) => setFilterMaand(e.target.value)}
                                            className="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Jaar Filter
                                        </label>
                                        <input
                                            type="number"
                                            value={filterJaar}
                                            onChange={(e) => setFilterJaar(e.target.value)}
                                            placeholder="2024"
                                            className="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        />
                                    </div>
                                </div>

                                {/* Totalen Cards */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="bg-blue-50 p-6 rounded-lg">
                                        <h3 className="text-lg font-semibold text-blue-800 mb-4">
                                            Maand Totalen ({filterMaand})
                                        </h3>
                                        <div className="space-y-2">
                                            <div className="flex justify-between">
                                                <span className="text-green-700">Zakelijk:</span>
                                                <span className="font-medium">{maandTotalen.zakelijk || 0} km</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-purple-700">Priv√©:</span>
                                                <span className="font-medium">{maandTotalen.prive || 0} km</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-orange-700">Gemengd:</span>
                                                <span className="font-medium">{maandTotalen.gemengd || 0} km</span>
                                            </div>
                                            <hr className="my-2" />
                                            <div className="flex justify-between text-lg font-bold">
                                                <span>Totaal:</span>
                                                <span className="text-blue-600">{maandTotalen.totaal || 0} km</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-green-50 p-6 rounded-lg">
                                        <h3 className="text-lg font-semibold text-green-800 mb-4">
                                            Jaar Totalen ({filterJaar})
                                        </h3>
                                        <div className="space-y-2">
                                            <div className="flex justify-between">
                                                <span className="text-green-700">Zakelijk:</span>
                                                <span className="font-medium">{jaarTotalen.zakelijk || 0} km</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-purple-700">Priv√©:</span>
                                                <span className="font-medium">{jaarTotalen.prive || 0} km</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-orange-700">Gemengd:</span>
                                                <span className="font-medium">{jaarTotalen.gemengd || 0} km</span>
                                            </div>
                                            <hr className="my-2" />
                                            <div className="flex justify-between text-lg font-bold">
                                                <span>Totaal:</span>
                                                <span className="text-green-600">{jaarTotalen.totaal || 0} km</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Recente Ritten */}
                                <div className="bg-white rounded-lg">
                                    <h3 className="text-lg font-semibold text-gray-800 mb-4">
                                        Alle Ritten ({ritten.length})
                                    </h3>
                                    {ritten.length === 0 ? (
                                        <p className="text-gray-500 text-center py-8">
                                            Nog geen ritten geregistreerd
                                        </p>
                                    ) : (
                                        <div className="overflow-x-auto">
                                            <table className="w-full border-collapse">
                                                <thead>
                                                    <tr className="bg-gray-50">
                                                        <th className="border border-gray-200 p-3 text-left">Datum</th>
                                                        <th className="border border-gray-200 p-3 text-left">Route</th>
                                                        <th className="border border-gray-200 p-3 text-left">KM</th>
                                                        <th className="border border-gray-200 p-3 text-left">Type</th>
                                                        <th className="border border-gray-200 p-3 text-left">Acties</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {ritten.slice().reverse().map((rit) => (
                                                        <tr key={rit.id} className="hover:bg-gray-50">
                                                            <td className="border border-gray-200 p-3">
                                                                {new Date(rit.datum).toLocaleDateString('nl-NL')}
                                                            </td>
                                                            <td className="border border-gray-200 p-3">
                                                                <div className="text-sm">
                                                                    <div><strong>Van:</strong> {rit.vertrekLocatie}</div>
                                                                    {rit.viaLocatie && (
                                                                        <div><strong>Via:</strong> {rit.viaLocatie}</div>
                                                                    )}
                                                                    <div><strong>Naar:</strong> {rit.eindLocatie}</div>
                                                                </div>
                                                            </td>
                                                            <td className="border border-gray-200 p-3 font-medium">
                                                                {rit.geredenKm} km
                                                            </td>
                                                            <td className="border border-gray-200 p-3">
                                                                <span className={`px-2 py-1 rounded text-sm font-medium ${
                                                                    rit.type === 'zakelijk' ? 'bg-green-100 text-green-800' :
                                                                    rit.type === 'prive' ? 'bg-purple-100 text-purple-800' :
                                                                    'bg-orange-100 text-orange-800'
                                                                }`}>
                                                                    {rit.type.charAt(0).toUpperCase() + rit.type.slice(1)}
                                                                </span>
                                                            </td>
                                                            <td className="border border-gray-200 p-3">
                                                                <div className="flex gap-2">
                                                                    <button
                                                                        onClick={() => bewerkRit(rit)}
                                                                        className="p-1 text-blue-600 hover:bg-blue-100 rounded"
                                                                        title="Bewerken"
                                                                    >
                                                                        <Edit />
                                                                    </button>
                                                                    <button
                                                                        onClick={() => verwijderRit(rit.id)}
                                                                        className="p-1 text-red-600 hover:bg-red-100 rounded"
                                                                        title="Verwijderen"
                                                                    >
                                                                        <Trash2 />
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Afkortingen Beheer */}
                        {viewMode === 'afkortingen' && (
                            <div className="space-y-6">
                                <div className="bg-blue-50 p-6 rounded-lg">
                                    <h3 className="text-lg font-semibold text-blue-800 mb-4">
                                        Nieuwe Afkorting Toevoegen
                                    </h3>
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Afkorting (max 5 karakters)
                                            </label>
                                            <input
                                                type="text"
                                                value={nieuweAfkorting.afkorting}
                                                onChange={(e) => setNieuweAfkorting({...nieuweAfkorting, afkorting: e.target.value})}
                                                placeholder="FO"
                                                maxLength="5"
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Volledige Naam
                                            </label>
                                            <input
                                                type="text"
                                                value={nieuweAfkorting.volledigeNaam}
                                                onChange={(e) => setNieuweAfkorting({...nieuweAfkorting, volledigeNaam: e.target.value})}
                                                placeholder="Frans Otten Stadion"
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Adres (optioneel)
                                            </label>
                                            <input
                                                type="text"
                                                value={nieuweAfkorting.adres}
                                                onChange={(e) => setNieuweAfkorting({...nieuweAfkorting, adres: e.target.value})}
                                                placeholder="Sportlaan 1, Den Haag"
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                        </div>
                                        <div className="flex items-end">
                                            <button
                                                onClick={voegAfkortingToe}
                                                className="w-full bg-green-600 text-white p-3 rounded-lg font-medium hover:bg-green-700 transition-colors"
                                            >
                                                Toevoegen
                                            </button>
                                        </div>
                                    </div>
                                    <div className="mt-4 text-sm text-gray-600">
                                        <strong>Tip:</strong> Na toevoegen kun je gewoon "FO" typen en het wordt automatisch "Frans Otten Stadion (Sportlaan 1, Den Haag)"
                                    </div>
                                </div>

                                <div className="bg-white rounded-lg">
                                    <h3 className="text-lg font-semibold text-gray-800 mb-4">
                                        Huidige Afkortingen ({Object.keys(afkortingen).filter(key => key === key.toUpperCase()).length})
                                    </h3>
                                    
                                    {Object.keys(afkortingen).filter(key => key === key.toUpperCase()).length === 0 ? (
                                        <p className="text-gray-500 text-center py-8">
                                            Nog geen afkortingen toegevoegd
                                        </p>
                                    ) : (
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {Object.keys(afkortingen)
                                                .filter(key => key === key.toUpperCase()) // Alleen hoofdletters tonen
                                                .sort()
                                                .map((afkorting) => {
                                                    const afkortingData = afkortingen[afkorting];
                                                    const isObject = typeof afkortingData === 'object';
                                                    return (
                                                        <div key={afkorting} className="bg-gray-50 p-4 rounded-lg">
                                                            <div className="flex justify-between items-start">
                                                                <div className="flex-1">
                                                                    <div className="font-bold text-blue-600 text-lg">{afkorting}</div>
                                                                    <div className="text-sm font-medium text-gray-800">
                                                                        {isObject ? afkortingData.naam : afkortingData}
                                                                    </div>
                                                                    {isObject && afkortingData.adres && (
                                                                        <div className="text-xs text-gray-500 mt-1">
                                                                            üìç {afkortingData.adres}
                                                                        </div>
                                                                    )}
                                                                </div>
                                                                <button
                                                                    onClick={() => verwijderAfkorting(afkorting)}
                                                                    className="p-2 text-red-600 hover:bg-red-100 rounded ml-2"
                                                                    title="Verwijderen"
                                                                >
                                                                    <Trash2 />
                                                                </button>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                        </div>
                                    )}
                                </div>

                                <div className="bg-yellow-50 p-4 rounded-lg">
                                    <h4 className="font-medium text-yellow-800 mb-2">üí° Hoe werkt het?</h4>
                                    <ul className="text-sm text-yellow-700 space-y-1">
                                        <li>‚Ä¢ Voeg afkortingen toe zoals "FO" ‚Üí "Frans Otten Stadion" + adres</li>
                                        <li>‚Ä¢ Bij invoeren: typ "FO" en het wordt automatisch naam + adres</li>
                                        <li>‚Ä¢ Adres is optioneel - alleen naam kan ook</li>
                                        <li>‚Ä¢ Werkt in alle locatievelden (vertrek, via, eind)</li>
                                        <li>‚Ä¢ Hoofdletters en kleine letters werken beide</li>
                                    </ul>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<KmRegistratieTool />, document.getElementById('root'));
    </script>
</body>
</html>